<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>Title</title>
</head>

<body>
    <div>
        <div id="info-player" class="flex flex-col">
            <ul class="flex flex-col" id="liste_joueurs"></ul>
        </div>
        <div>
            <button onclick="left()">
                Clique moi
            </button>
        </div>

        <div id="tablier"></div>
    </div>
    <script>
        const socket = io()
        const infoPlayer = document.getElementById('liste_joueurs')


        const couleurs = ['red', 'blue']

        socket.emit('player_join', () => {
            message: "Un joueur s'est connectÃ©"
        })

        socket.on('response', (data) => {
            if (!localStorage.getItem('player')) {
                localStorage.setItem('player', data[data.length - 1].username)
            }
            console.log(localStorage.getItem('player'))
            console.log(data);
            //infoPlayer.innerHTML = ''

            while (infoPlayer.firstChild) {
                infoPlayer.removeChild(infoPlayer.lastChild)
            }
            data.forEach((item) => {

                const li = document.createElement('li')
                infoPlayer.append(item.username, li);
            })
        })

        socket.on('start', (data) => {
            console.log("The game start", data)
        })

        function left() {
            localStorage.clear()
            window.location.assign('/')

        }
    </script>
    <script>
        window.addEventListener('load', (event) => {
            genereDamier(20, 11, 11);
        });

        function creeHexagone(rayon) {
            let points = new Array();
            for (var i = 0; i < 6; ++i) {
                var angle = i * Math.PI / 3;
                var x = Math.sin(angle) * rayon;
                var y = -Math.cos(angle) * rayon;
                points.push([Math.round(x * 100) / 100, Math.round(y * 100) / 100]);
            }
            return points;
        }

        function genereDamier(rayon, nbLignes, nbColonnes) {
            distance = rayon - (Math.sin(1 * Math.PI / 3) * rayon);
            distance = distance * 1.5;
            rayon = rayon * 1.5;
            d3.select("#tablier").append("svg").attr("width", (nbLignes * 2) * 2 * rayon).attr("height", (nbLignes * 2) * 2 * rayon);
            var hexagone = creeHexagone(rayon);
            var decalage = 0;
            for (var ligne = 0; ligne < nbLignes; ligne++) {
                for (var colonne = 0; colonne < nbColonnes; colonne++) {
                    var d = "";
                    var x, y;
                    for (h in hexagone) {
                        x = hexagone[h][0] + (rayon - distance) * (2 + decalage + 1 * colonne);
                        y = distance * 2 + hexagone[h][1] + (rayon - distance * 2) * (1 + 2 * colonne);
                        if (h == 0) d += "M" + x + "," + y + " L";
                        else d += x + "," + y + " ";
                    }
                    d += "Z";
                    d3.select("svg")
                        .append("path")
                        .attr("d", d).attr("stroke", "black").attr("fill", "white")
                        .attr("id", "h" + (ligne * 11 + colonne))
                        .on("click", function(d) {
                            const id = d3.select(this).attr('id').split('h')[1]
                            console.log(id)
                            socket.emit('pion', {
                                case: id,
                                player: localStorage.getItem('player')
                            });
                        });
                }
                decalage += 2;
            }
        }
    </script>

    <script>
        socket.on('pion', (data) => {
            console.log(data)
        })
    </script>
</body>

</html>